# Implementation Plan: AI Chatbot

**Branch**: `007-ai-chatbot` | **Date**: 2025-01-27 | **Spec**: [spec.md](./spec.md)  
**Input**: Feature specification from `/specs/007-ai-chatbot/spec.md`

**Note**: This plan is generated by the `/speckit.plan` command based on research of the reference implementation at https://images-hub-pim.vercel.app/

## Summary

Implement an AI-powered chatbot widget that provides instant answers about company services, navigates users to relevant pages, and supports multiple languages. The chatbot uses Vercel AI Gateway with DeepSeek LLM for intelligent responses, with fallback to rule-based responses for common questions. The implementation matches the reference design exactly, featuring a floating button in the bottom-right corner that opens a chat panel. Chat sessions persist within browser sessions using sessionStorage, and rate limiting prevents abuse (20 messages/hour per visitor).

## Technical Context

**Language/Version**: TypeScript 5.0+ (strict mode), React 19+, Next.js 15.2+  
**Primary Dependencies**: 
- `ai` - Vercel AI SDK core
- `@ai-sdk/react` - React hooks for AI SDK
- `@ai-sdk/deepseek` - DeepSeek provider for local development
- `framer-motion` - Animations (already installed)
- `shadcn/ui` - UI components (already installed)

**Storage**: Browser sessionStorage (client-side only, no server-side persistence)  
**Testing**: Manual testing + Jest/React Testing Library (if automated tests added)  
**Target Platform**: Web (Next.js App Router), modern browsers with sessionStorage support  
**Project Type**: Web application (Next.js App Router structure)

**Performance Goals**:
- Response time: <3 seconds for common questions (SC-001)
- Full conversation flow: <2 minutes (SC-006)
- Uptime: 99% during business hours (SC-005)
- Error rate: <1% of interactions (SC-007)

**Constraints**:
- No authentication required (public-facing)
- Rate limiting: 20 messages/hour per visitor
- Maximum 100 messages per session
- SessionStorage quota limits (~5-10MB typical)
- Edge runtime for API route (lower latency)
- 60-second timeout per API request

**Scale/Scope**:
- Unlimited concurrent visitors (client-side only, no server state)
- ~50KB per session (100 messages max)
- No database queries (all client-side)
- API route handles streaming responses

## Constitution Check

_GATE: Must pass before Phase 0 research. Re-check after Phase 1 design._

### ✅ Next.js App Router Architecture
- **Status**: PASS
- **Compliance**: Using App Router structure (`app/api/chat/route.ts`), Server Components by default, Client Components with `'use client'` directive
- **Rationale**: Follows Next.js 15 App Router conventions exactly

### ✅ TypeScript Strict Mode
- **Status**: PASS
- **Compliance**: All code uses TypeScript with strict mode, type definitions in `src/types/chat-widget.ts`, no `any` types
- **Rationale**: Type safety maintained throughout implementation

### ✅ Component-Based Design with shadcn/ui
- **Status**: PASS
- **Compliance**: Functional React components, shadcn/ui components (Card, Button, Input, ScrollArea), Tailwind CSS utility classes only
- **Rationale**: Matches existing codebase patterns and reference implementation

### ✅ Performance Optimization Standards
- **Status**: PASS
- **Compliance**: Edge runtime for API route, streaming responses, lazy loading for ChatWidget, code splitting
- **Rationale**: Optimized for low latency and fast response times

### ✅ Accessibility & Semantic HTML
- **Status**: PASS
- **Compliance**: ARIA attributes (role="dialog", aria-label, aria-modal), keyboard navigation (Escape, Enter, Tab), semantic HTML elements
- **Rationale**: WCAG AA compliant, accessible to screen readers

**Post-Design Check**: All gates pass. Implementation follows constitution principles.

## Project Structure

### Documentation (this feature)

```text
specs/[###-feature]/
├── plan.md              # This file (/speckit.plan command output)
├── research.md          # Phase 0 output (/speckit.plan command)
├── data-model.md        # Phase 1 output (/speckit.plan command)
├── quickstart.md        # Phase 1 output (/speckit.plan command)
├── contracts/           # Phase 1 output (/speckit.plan command)
└── tasks.md             # Phase 2 output (/speckit.tasks command - NOT created by /speckit.plan)
```

### Source Code (repository root)

```text
src/
├── app/
│   ├── api/
│   │   └── chat/
│   │       └── route.ts              # API route handler (Edge runtime)
│   └── layout.tsx                    # Root layout (add ChatWidget here)
├── components/
│   └── chat-widget/
│       ├── chat-widget.tsx           # Main widget component
│       ├── chat-widget-icon.tsx      # Floating icon button
│       └── chat-widget-panel.tsx     # Chat panel with messages
├── lib/
│   ├── hooks/
│   │   └── use-chat-widget.ts        # State management hook
│   └── utils/
│       └── storage.ts                # sessionStorage utilities
└── types/
    └── chat-widget.ts                # TypeScript type definitions

public/
└── assets/
    └── angel.webp                         # Chat widget icon (moved to assets)
```

**Structure Decision**: Web application structure following Next.js App Router conventions. Components organized in `src/components/chat-widget/`, hooks in `src/lib/hooks/`, utilities in `src/lib/utils/`, types in `src/types/`. API route follows Next.js 15 App Router pattern in `src/app/api/chat/route.ts`.

## Complexity Tracking

> **No violations detected - all constitution gates pass**

No complexity violations. Implementation follows all constitution principles:
- Uses Next.js App Router structure (existing pattern)
- TypeScript strict mode (existing standard)
- shadcn/ui components (existing library)
- Tailwind CSS only (existing standard)
- Accessible components (existing requirement)

The implementation complexity is justified by:
- Feature requirements (AI integration, multi-language, rate limiting)
- Reference implementation patterns (proven architecture)
- User requirement to match reference exactly
